<!-- Info Panel - CSS-only drawer using checkbox pattern -->
<input type="checkbox" id="info-panel-toggle" class="info-panel-checkbox" aria-label="Toggle info panel">
<aside class="info-panel" aria-label="Document information">
  <div class="info-panel-content">
    <!-- Close button -->
    <label for="info-panel-toggle" class="info-panel-close" aria-label="Close info panel">
      <span class="info-panel-close-icon">&times;</span>
    </label>

    <h2>Info</h2>

    <!-- Frontmatter Metadata Section (populated by JavaScript from window.frontmatter) -->
    <details class="info-section" id="info-metadata-section" open>
      <summary><strong>Metadata</strong></summary>
      <div class="info-content" id="info-metadata-content">
        <!-- Populated dynamically from window.frontmatter -->
      </div>
    </details>
    <script>
      (function() {
        const container = document.getElementById('info-metadata-content');
        const section = document.getElementById('info-metadata-section');
        const fm = window.frontmatter || {};

        // Keys to skip (internal/technical fields)
        const skipKeys = new Set(['markdown_source', 'server_mode']);

        // Preferred display order for common keys
        const preferredOrder = ['title', 'description', 'tags', 'keywords', 'date', 'author', 'category', 'categories', 'draft', 'slug'];

        // Get all keys and sort them
        const allKeys = Object.keys(fm).filter(k => !skipKeys.has(k));
        const orderedKeys = [...preferredOrder.filter(k => allKeys.includes(k)), ...allKeys.filter(k => !preferredOrder.includes(k))];

        if (orderedKeys.length === 0) {
          section.style.display = 'none';
        } else {
          orderedKeys.forEach(key => {
            const value = fm[key];
            if (value === null || value === undefined || value === '') return;

            const item = document.createElement('div');
            item.className = 'info-item';

            const label = document.createElement('span');
            label.className = 'info-label';
            label.textContent = key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ') + ':';

            const val = document.createElement('span');
            val.className = 'info-value';

            // Format arrays and objects nicely
            if (Array.isArray(value)) {
              val.textContent = value.join(', ');
            } else if (typeof value === 'object') {
              val.textContent = JSON.stringify(value);
            } else {
              val.textContent = String(value);
            }

            item.appendChild(label);
            item.appendChild(val);
            container.appendChild(item);
          });
        }
      })();
    </script>

    <!-- Table of Contents Section -->
    {% if headings %}
    <details class="info-section" open>
      <summary><strong>Table of Contents</strong></summary>
      <nav class="toc-nav">
        <ul class="toc-list">
        {% for heading in headings %}
          <li class="toc-item toc-level-{{ heading.level }}">
            <a href="#{{ heading.id }}">{{ heading.text }}</a>
          </li>
        {% endfor %}
        </ul>
      </nav>
    </details>
    {% endif %}

    <!-- Links Out Section (Placeholder) -->
    <details class="info-section">
      <summary><strong>Links Out</strong></summary>
      <div class="info-content">
        <p><em>Links from this document (coming soon)</em></p>
      </div>
    </details>

    <!-- Links In Section (Placeholder) -->
    <details class="info-section">
      <summary><strong>Links In</strong></summary>
      <div class="info-content">
        <p><em>Links to this document (coming soon)</em></p>
      </div>
    </details>
  </div>
</aside>

<!-- Backdrop overlay for mobile -->
<label for="info-panel-toggle" class="info-panel-backdrop" aria-label="Close info panel"></label>
