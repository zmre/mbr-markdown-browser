{% set asset_base = relative_base | default(value="/.mbr/") %}
{% include "_head.html" %}
    {# HLJS and KaTeX CSS are now loaded dynamically by mbr-hljs and mbr-katex components #}
    {% if tags %}
        {% if tags is string %}
    <meta name="keywords" content="{{tags}}" data-pagefind-filter="tag[content]" />
        {% else %}
    <meta name="keywords" content="{{tags | join(sep=', ')}}" data-pagefind-filter="tag[content]" />
        {% endif %}
    {% elif keywords %}
        {% if keywords is string %}
    <meta name="keywords" content="{{keywords}}" data-pagefind-filter="tag[content]" />
        {% else %}
    <meta name="keywords" content="{{keywords | join(sep=', ')}}" data-pagefind-filter="tag[content]" />
        {% endif %}
    {% elif taxonomy.tags %}
        {% if taxonomy.tags is string %}
    <meta name="keywords" content="{{taxonomy.tags}}" data-pagefind-filter="tag[content]" />
        {% else %}
    <meta name="keywords" content="{{taxonomy.tags | join(sep=', ')}}" data-pagefind-filter="tag[content]" />
        {% endif %}
    {% endif %}
    <title>{{title | default(value="") | safe}}</title>
    <meta name="title" content="{{title | default(value="") | safe}}" data-pagefind-meta="title[content]" />
    <meta name="description" content="{{description | default(value="") | safe}}" data-pagefind-meta="description[content]" />
    <meta http-equiv="last-modified" content="{{date | default(value="") | safe}}" data-pagefind-sort="date[content]" />
    <script>
      // Frontmatter available to page scripts (excludes rendered markdown for efficiency)
      window.frontmatter = {{ frontmatter_json | safe }};
      // Headings for table of contents
      window.headings = [
        {% for heading in headings %}
        { level: {{ heading.level }}, id: "{{ heading.id }}", text: "{{ heading.text | escape }}" }{% if not loop.last %},{% endif %}
        {% endfor %}
      ];
      // Extended metadata
      window.extendedMeta = {
        wordCount: {{ word_count | default(value=0) }},
        readingTimeMinutes: {{ reading_time_minutes | default(value=0) }},
        filePath: "{{ file_path | default(value='') | safe }}",
        modifiedTimestamp: {{ modified_timestamp | default(value=0) }},
        {% if prev_page %}prevPage: { url: "{{ prev_page.url | safe }}", title: "{{ prev_page.title | escape }}" },{% endif %}
        {% if next_page %}nextPage: { url: "{{ next_page.url | safe }}", title: "{{ next_page.title | escape }}" }{% endif %}
      };
    </script>
